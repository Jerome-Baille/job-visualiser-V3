<div class="export-data mat-elevation-z1">
  <mat-form-field appearance="outline">
    <mat-label>Filter by</mat-label>
    <mat-select [formControl]="form.controls.mode">
      <mat-option [value]="'year'">Year</mat-option>
      <mat-option [value]="'single'">Single date</mat-option>
      <mat-option [value]="'range'">Date range</mat-option>
    </mat-select>
  </mat-form-field>

  @if (form.controls.mode.value === 'year') {
  <mat-form-field appearance="outline">
    <mat-label>Year</mat-label>
    <mat-select [formControl]="form.controls.year">
      <mat-option value="">Select a year</mat-option>
      @for (year of years(); track year) {
      <mat-option [value]="year === 'All Years' ? '0000' : year">{{
        year
      }}</mat-option>
      }
    </mat-select>
  </mat-form-field>
  }

  @if (form.controls.mode.value === 'single') {
  <mat-form-field appearance="outline">
    <mat-label>Date</mat-label>
    <input matInput [matDatepicker]="singlePicker" [formControl]="form.controls.singleDate" placeholder="Choose a date" />
    <mat-datepicker-toggle matIconSuffix [for]="singlePicker"></mat-datepicker-toggle>
    <mat-datepicker #singlePicker></mat-datepicker>
  </mat-form-field>
  }

  @if (form.controls.mode.value === 'range') {
  <mat-form-field appearance="outline" class="date-range-field">
    <mat-label>Date range</mat-label>
    <mat-date-range-input [formGroup]="form.controls.range" [rangePicker]="rangePicker">
      <input matStartDate formControlName="start" placeholder="Start date" />
      <input matEndDate formControlName="end" placeholder="End date" />
    </mat-date-range-input>
    <mat-datepicker-toggle matIconSuffix [for]="rangePicker"></mat-datepicker-toggle>
    <mat-date-range-picker #rangePicker></mat-date-range-picker>
  </mat-form-field>
  }

  <mat-form-field appearance="outline">
    <mat-label>Format</mat-label>
    <mat-select [formControl]="form.controls.format">
      @if (form.controls.format.value) {
      <mat-select-trigger>
        <div class="option-with-icon">
          <mat-icon>{{ selectedFormatOption?.icon }}</mat-icon>
          <span>{{ selectedFormatOption?.label }}</span>
        </div>
      </mat-select-trigger>
      }
      <mat-option value="">Select a format</mat-option>
      @for (option of formatOptions; track option) {
      <mat-option [value]="option.value">
        <div class="option-with-icon">
          <mat-icon>{{ option.icon }}</mat-icon>
          <span>{{ option.label }}</span>
        </div>
      </mat-option>
      }
    </mat-select>
  </mat-form-field>

  <button
    mat-raised-button
    color="primary"
    (click)="handleExportClick()"
    [disabled]="!canExport"
  >
    <mat-icon>download</mat-icon>
    Export
  </button>
</div>
