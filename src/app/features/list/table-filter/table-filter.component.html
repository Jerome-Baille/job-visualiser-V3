<div class="filter-panel">
  <mat-expansion-panel [expanded]="false">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <mat-icon>filter_list</mat-icon>
        <span class="panel-title-text">Search & Filter</span>
      </mat-panel-title>
    </mat-expansion-panel-header>

    <div class="filter-container">
      <mat-form-field appearance="outline">
        <mat-label>Date filter</mat-label>
        <mat-select [(value)]="dateMode" (selectionChange)="onDateModeChange()">
          <mat-option value="all">All dates</mat-option>
          <mat-option value="year">Year</mat-option>
          <mat-option value="single">Single date</mat-option>
          <mat-option value="range">Date range</mat-option>
        </mat-select>
      </mat-form-field>

      @if (dateMode === 'year') {
        <mat-form-field appearance="outline">
          <mat-label>Year</mat-label>
          <mat-select [(value)]="selectedYear" (selectionChange)="filterJobs()">
            <mat-option value="">Select a year</mat-option>
            @for (year of years; track year) {
              <mat-option [value]="year === 'All Years' ? '0000' : year">{{ year }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      }

      @if (dateMode === 'single') {
        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="singlePicker" [(ngModel)]="singleDate" (dateChange)="filterJobs()" placeholder="Choose a date" />
          <mat-datepicker-toggle matIconSuffix [for]="singlePicker"></mat-datepicker-toggle>
          <mat-datepicker #singlePicker></mat-datepicker>
        </mat-form-field>
      }

      @if (dateMode === 'range') {
        <mat-form-field appearance="outline" class="date-range-field">
          <mat-label>Date range</mat-label>
          <mat-date-range-input [rangePicker]="rangePicker">
            <input matStartDate placeholder="Start date" [(ngModel)]="rangeStart" (dateChange)="filterJobs()" />
            <input matEndDate placeholder="End date" [(ngModel)]="rangeEnd" (dateChange)="filterJobs()" />
          </mat-date-range-input>
          <mat-datepicker-toggle matIconSuffix [for]="rangePicker"></mat-datepicker-toggle>
          <mat-date-range-picker #rangePicker></mat-date-range-picker>
        </mat-form-field>
      }

      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search Jobs</mat-label>
        <input matInput placeholder="Search by job title, company, etc."
          [(ngModel)]="searchValueJobs"
          (keyup)="filterJobs()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <mat-select [(value)]="typeFilter" (selectionChange)="filterJobs()">
            <mat-select-trigger>
              @if (typeFilter !== 'all') {
                <span class="option-with-icon">
                  @if (typeFilter === 'remote') {
                    <mat-icon>home</mat-icon>
                  }
                  @if (typeFilter === 'hybrid') {
                    <mat-icon>compare_arrows</mat-icon>
                  }
                  @if (typeFilter === 'on site') {
                    <mat-icon>business</mat-icon>
                  }
                  <span>
                    {{ typeFilter === 'remote' ? 'Remote' : (typeFilter === 'hybrid' ? 'Hybrid' : (typeFilter === 'on site' ? 'On site' : 'All Types')) }}
                  </span>
                </span>
              }
              @if (typeFilter === 'all') {
                <span>All Types</span>
              }
            </mat-select-trigger>
            <mat-option value="all">All Types</mat-option>
            <mat-option value="remote">
              <span class="option-with-icon">
                <mat-icon>home</mat-icon>
                Remote
              </span>
            </mat-option>
            <mat-option value="hybrid">
              <span class="option-with-icon">
                <mat-icon>compare_arrows</mat-icon>
                Hybrid
              </span>
            </mat-option>
            <mat-option value="on site">
              <span class="option-with-icon">
                <mat-icon>business</mat-icon>
                On site
              </span>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [(value)]="decisionFilter" (selectionChange)="filterJobs()">
            <mat-select-trigger>
              @if (decisionFilter !== 'all') {
                <span class="option-with-icon">
                  @if (decisionFilter === 'positive') {
                    <mat-icon class="success-icon">check_circle</mat-icon>
                  }
                  @if (decisionFilter === 'negative') {
                    <mat-icon class="error-icon">cancel</mat-icon>
                  }
                  @if (decisionFilter === 'in progress') {
                    <mat-icon class="info-icon">hourglass_empty</mat-icon>
                  }
                  @if (decisionFilter === 'expired') {
                    <mat-icon class="warning-icon">watch_later</mat-icon>
                  }
                  <span>
                    {{ decisionFilter === 'positive' ? 'Positive' : (decisionFilter === 'negative' ? 'Negative' : (decisionFilter === 'in progress' ? 'In Progress' : (decisionFilter === 'expired' ? 'Expired' : 'All Statuses'))) }}
                  </span>
                </span>
              }
              @if (decisionFilter === 'all') {
                <span>All Statuses</span>
              }
            </mat-select-trigger>
            <mat-option value="all">All Statuses</mat-option>
            <mat-option value="positive" class="positive-option">
              <span class="option-with-icon">
                <mat-icon class="success-icon">check_circle</mat-icon>
                Positive
              </span>
            </mat-option>
            <mat-option value="negative" class="negative-option">
              <span class="option-with-icon">
                <mat-icon class="error-icon">cancel</mat-icon>
                Negative
              </span>
            </mat-option>
            <mat-option value="in progress" class="in-progress-option">
              <span class="option-with-icon">
                <mat-icon class="info-icon">hourglass_empty</mat-icon>
                In Progress
              </span>
            </mat-option>
            <mat-option value="expired" class="expired-option">
              <span class="option-with-icon">
                <mat-icon class="warning-icon">watch_later</mat-icon>
                Expired
              </span>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="actions">
          <button mat-button color="warn" class="reset-btn" (click)="handleReset()">
            <mat-icon>refresh</mat-icon>
            Reset
          </button>
        </div>
      </div>
    </mat-expansion-panel>
  </div>
