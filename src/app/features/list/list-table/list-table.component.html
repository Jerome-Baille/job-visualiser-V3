<div class="list-table">
  <app-table-filter (filterChange)="onFilterChange($event)"></app-table-filter>

  <!-- Status notification message when filtering both unknown and expired -->
  @if (includeExpired() && filterStatus() === 'unknown') {
  <div class="status-notification">
    <mat-icon>info</mat-icon>
    <span>Showing both Unknown and Expired status jobs</span>
  </div>
  }

  <mat-card>
    <mat-card-content>
      <div>
        <table mat-table [dataSource]="dataSource" matSort class="job-table">
          <ng-container matColumnDef="name">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="header-colored"
            >
              <span class="header-cell-content">
                <mat-icon class="header-icon">work_outline</mat-icon>
                <span class="header-text">Job position</span>
              </span>
            </th>
            <td mat-cell *matCellDef="let job">
              <a
                class="row-overlay"
                [routerLink]="['/job', job.id]"
                aria-label="Open job details"
              ></a>
              <span class="cell-content">{{ job.name }}</span>
            </td>
          </ng-container>
          <ng-container matColumnDef="company">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="header-colored"
            >
              <span class="header-cell-content">
                <mat-icon class="header-icon">apartment</mat-icon>
                <span class="header-text">Company</span>
              </span>
            </th>
            <td mat-cell *matCellDef="let job">
              <span class="cell-content">{{ job.company }}</span>
            </td>
          </ng-container>
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef class="header-colored">
              <span class="header-cell-content">
                <mat-icon class="header-icon">category</mat-icon>
                <span class="header-text">Type</span>
              </span>
            </th>
            <td mat-cell *matCellDef="let job">{{ job.type }}</td>
          </ng-container>
          <ng-container matColumnDef="applicationDate">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              class="header-colored mat-column-applicationDate"
            >
              <span class="header-cell-content">
                <mat-icon class="header-icon">event</mat-icon>
                <span class="header-text">Date</span>
              </span>
            </th>
            <td mat-cell *matCellDef="let job">
              <span class="date-cell">{{
                formatDateDDMMYYYY(job.applicationDate)
              }}</span>
            </td>
          </ng-container>
          <ng-container matColumnDef="decision">
            <th mat-header-cell *matHeaderCellDef class="header-colored">
              <span class="header-cell-content">
                <mat-icon class="header-icon">task_alt</mat-icon>
                <span class="header-text">Decision</span>
              </span>
            </th>
            <td mat-cell *matCellDef="let job">
              <mat-form-field
                appearance="outline"
                class="decision-select"
                [ngClass]="{
                  'positive-select': job.decision === 'positive',
                  'negative-select': job.decision === 'negative',
                  'in-progress-select': job.decision === 'in progress',
                  'expired-select': job.decision === 'expired'
                }"
                (click)="$event.stopPropagation()"
              >
                <mat-select
                  [value]="job.decision"
                  (selectionChange)="onDecisionChange(job, $event.value)"
                  aria-label="Final decision on the candidacy"
                  disableOptionCentering
                  panelClass="status-select-panel"
                  (openedChange)="($event ? $event : null)"
                >
                  @for (status of decisionStatuses; track status) {
                  <mat-option
                    [value]="status.value"
                    (click)="$event.stopPropagation()"
                  >
                    {{ status.label }}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </td>
          </ng-container>
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns()"
            class="header-colored-row"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns()"
            [ngClass]="{
              'status-positive': row.decision === 'positive',
              'status-negative': row.decision === 'negative',
              'status-in-progress': row.decision === 'in progress',
              'status-expired': row.decision === 'expired'
            }"
            style="cursor: pointer"
          ></tr>
        </table>
        <div class="footer-bar">
          <mat-paginator
            [length]="totalItems()"
            [pageIndex]="currentPage()"
            [pageSize]="pageSize()"
            [pageSizeOptions]="pageSizeOptions"
            (page)="onPageChange($event)"
            showFirstLastButtons
            aria-label="Select page of jobs"
          ></mat-paginator>
          @if (paginationInfo()) {
          <div class="pagination-info">
            <span>
              Showing <b>{{ currentPage() * pageSize() + 1 }}</b> -
              <b>{{
                Math.min((currentPage() + 1) * pageSize(), totalItems())
              }}</b>
              of <b>{{ totalItems() }}</b> results
            </span>
          </div>
          }
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
