<div class="job-detail-container">
  @if (profileForm) {
    <mat-card class="job-card">
      <mat-card-header>
        <mat-card-title>My Profile</mat-card-title>
        <mat-card-subtitle>Update your account information</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="job-form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
              <mat-label>Username</mat-label>
              <input matInput formControlName="username">
              <mat-icon matSuffix>person</mat-icon>
              @if (profileForm.get('username')?.errors?.['required']) {
                <mat-error>
                  Username is required
                </mat-error>
              }
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
              <mat-label>Password</mat-label>
              <input matInput [type]="showPassword ? 'text' : 'password'" formControlName="password">
              <button type="button" mat-icon-button matSuffix (click)="togglePassword()" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="showPassword">
                <mat-icon>{{showPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (profileForm.get('password')?.errors?.['required']) {
                <mat-error>
                  Password is required
                </mat-error>
              }
              @if (profileForm.get('password')?.errors?.['minlength']) {
                <mat-error>
                  Password must be at least 8 characters
                </mat-error>
              }
              @if (profileForm.get('password')?.errors?.['maxlength']) {
                <mat-error>
                  Password must not exceed 100 characters
                </mat-error>
              }
              @if (profileForm.get('password')?.errors?.['pattern']) {
                <mat-error>
                  Password must include lowercase, uppercase, and a digit
                </mat-error>
              }
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline" class="wide-field">
              <mat-label>Confirm Password</mat-label>
              <input matInput [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword">
              <button type="button" mat-icon-button matSuffix (click)="toggleConfirmPassword()" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="showConfirmPassword">
                <mat-icon>{{showConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              @if (profileForm.hasError('mismatch') && profileForm.get('confirmPassword')?.touched) {
                <mat-error>
                  Passwords must match
                </mat-error>
              }
            </mat-form-field>
          </div>
        </form>
      </mat-card-content>
      <mat-divider></mat-divider>
      <mat-card-actions>
        <div class="action-buttons">
          <button type="button" mat-stroked-button color="warn" (click)="openDeleteDialog()">
            <mat-icon>delete</mat-icon> Delete Account
          </button>
          <span class="spacer"></span>        <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="isSubmitting || !profileForm.valid" class="submit-button">
          @if (!isSubmitting) {
            <mat-icon>save</mat-icon>
          }
          @if (isSubmitting) {
            <mat-spinner diameter="24"></mat-spinner>
          }
          @if (!isSubmitting) {
            <span>Save Changes</span>
          }
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
}
</div>
